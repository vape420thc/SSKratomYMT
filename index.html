<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏£‡πà‡∏£‡∏¥‡∏°‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --p: #2e7d32; --p-light: #e8f5e9; --avail: #4caf50; --res: #ff9800; --occ: #f44336; }
        body { font-family: 'Kanit', sans-serif; background: #f4f7f4; margin: 0; color: #333; }
        .header { background: linear-gradient(135deg, #1b5e20, var(--p)); color: white; padding: 25px 20px; text-align: center; border-radius: 0 0 30px 30px; }
        .nav { display: flex; background: white; sticky: top; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; border-bottom: 3px solid transparent; font-weight: 500; }
        .tab.active { color: var(--p); border-bottom-color: var(--p); background: var(--p-light); }
        .content { padding: 20px; max-width: 600px; margin: auto; }
        
        /* Grid & Table Cards */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 25px; }
        .t-card { background: white; border-radius: 15px; padding: 15px; text-align: center; border: 2px solid #eee; transition: 0.2s; cursor: pointer; }
        .t-card.selected { border-color: #000; transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .t-card.reserved { background: #fff8e1; border-color: var(--res); color: var(--res); cursor: not-allowed; }
        .t-card.occupied { background: #ffebee; border-color: var(--occ); color: var(--occ); cursor: not-allowed; }
        .t-card b { font-size: 1.4rem; display: block; }
        
        /* Login Screen */
        .login-box { background: white; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-top: 50px; }
        
        /* Form & Admin */
        .form-box { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; font-family: 'Kanit'; box-sizing: border-box; }
        button.btn-main { background: var(--p); color: white; border: none; font-weight: 600; cursor: pointer; }
        .admin-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--p); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .btn-group { display: flex; flex-direction: column; gap: 5px; }
        .btn-sm { width: auto; padding: 6px 12px; font-size: 0.8rem; margin: 0; border: none; color: white; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0; font-size:1.8rem;">‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏£‡πà‡∏£‡∏¥‡∏°‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô</h1>
    <p style="margin:5px 0 0; opacity:0.9; font-weight:300;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞</p>
</div>

<div class="nav">
    <div class="tab active" onclick="showTab('booking')"><i class="fas fa-chair"></i> ‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞</div>
    <div class="tab" onclick="showTab('admin')"><i class="fas fa-lock"></i> ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</div>
</div>

<div id="booking" class="content">
    <div style="background:white; padding:15px; border-radius:15px; margin-bottom:20px;">
        <label>üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input type="date" id="targetDate" onchange="fetchData()">
    </div>

    <h4 style="color:var(--p)"><i class="fas fa-water"></i> ‡πÇ‡∏ã‡∏ô‡∏£‡∏¥‡∏°‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô (V1-V9)</h4>
    <div class="grid" id="viewZone"></div>

    <h4 style="color:#5d4037"><i class="fas fa-store"></i> ‡πÇ‡∏ã‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (G1-G6)</h4>
    <div class="grid" id="genZone"></div>

    <div class="form-box">
        <h3 id="tableTitle" style="margin-top:0">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞...</h3>
        <form id="bookingForm" onsubmit="handleFormSubmit(event)">
            <input type="text" id="n" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á" required>
            <input type="tel" id="ph" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" required>
            <div style="display:flex; gap:10px;">
                <input type="time" id="tm" value="17:00" required>
                <select id="p">
                    <option>1-2 ‡∏ó‡πà‡∏≤‡∏ô</option><option>3-4 ‡∏ó‡πà‡∏≤‡∏ô</option>
                    <option>5-8 ‡∏ó‡πà‡∏≤‡∏ô</option><option>10+ ‡∏ó‡πà‡∏≤‡∏ô</option>
                </select>
            </div>
            <button type="submit" class="btn-main">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </form>
    </div>
</div>

<div id="admin" class="content" style="display:none">
    <div id="loginArea" class="login-box">
        <h3><i class="fas fa-user-shield"></i> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
        <input type="password" id="staffPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        <button onclick="checkLogin()" class="btn-main">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <p id="loginError" style="color:red; display:none;">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</p>
    </div>

    <div id="adminArea" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 id="adminDateLabel">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
            <button onclick="logout()" style="width:auto; padding:5px 10px; background:#666; border:none; color:white; border-radius:5px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
        <div id="adminList"></div>
    </div>
</div>

<script>
    const WEB_HOOK = "https://script.google.com/macros/s/AKfycbwGyKDlaSGMBsjAT5MyAqfHe3Bnmhy7dJuryF9B7n9zIK8aeSkoDi4Y-TS4qbXn7yBkkQ/exec";
    const STAFF_PASSWORD = "Tiggerss"; // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    
    let selectedTable = null;
    let bookings = [];
    let isLoggedIn = false;

    document.getElementById('targetDate').valueAsDate = new Date();
    fetchData();

    function showTab(t) {
        document.getElementById('booking').style.display = t === 'booking' ? 'block' : 'none';
        document.getElementById('admin').style.display = t === 'admin' ? 'block' : 'none';
        document.querySelectorAll('.tab').forEach((el, i) => {
            el.classList.toggle('active', (t === 'booking' && i === 0) || (t === 'admin' && i === 1));
        });
        
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ó‡πá‡∏ö Admin ‡πÅ‡∏•‡∏∞‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
        if (t === 'admin' && isLoggedIn) {
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('adminArea').style.display = 'block';
        }
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
    function checkLogin() {
        const pass = document.getElementById('staffPass').value;
        if (pass === STAFF_PASSWORD) {
            isLoggedIn = true;
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('adminArea').style.display = 'block';
            render(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        } else {
            document.getElementById('loginError').style.display = 'block';
            document.getElementById('staffPass').value = '';
        }
    }

    function logout() {
        isLoggedIn = false;
        document.getElementById('staffPass').value = '';
        document.getElementById('loginArea').style.display = 'block';
        document.getElementById('adminArea').style.display = 'none';
        document.getElementById('loginError').style.display = 'none';
    }

    async function fetchData() {
        const date = document.getElementById('targetDate').value;
        try {
            const res = await fetch(`${WEB_HOOK}?action=get_data&date=${date}&_t=${Date.now()}`);
            bookings = await res.json();
            render();
        } catch (err) { console.error("Error fetching data"); }
    }

    function render() {
        const v = document.getElementById('viewZone'); v.innerHTML = '';
        const g = document.getElementById('genZone'); g.innerHTML = '';
        const list = document.getElementById('adminList'); list.innerHTML = '';

        for (let i = 1; i <= 15; i++) {
            const no = i <= 9 ? 'V' + i : 'G' + (i - 9);
            const b = bookings.find(x => x.table === no);
            const status = b ? b.status : 'available';
            
            const card = document.createElement('div');
            card.className = `t-card ${status} ${selectedTable === no ? 'selected' : ''}`;
            card.innerHTML = `<b>${no}</b><span>${status === 'available' ? '‡∏ß‡πà‡∏≤‡∏á' : (status === 'reserved' ? '‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤')}</span>`;
            
            if (status === 'available') {
                card.onclick = () => {
                    selectedTable = no;
                    document.getElementById('tableTitle').innerHTML = `‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <span style="color:var(--p)">${no}</span>`;
                    render();
                };
            }
            if (i <= 9) v.appendChild(card); else g.appendChild(card);
        }

        if (bookings.length === 0) {
            list.innerHTML = '<p style="text-align:center; padding:20px; color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>';
        } else {
            bookings.forEach(b => {
                const div = document.createElement('div');
                div.className = 'admin-card';
                div.style.backgroundColor = b.status === 'occupied' ? '#fff5f5' : 'white';
                div.innerHTML = `
                    <div style="flex:1">
                        <strong>‡πÇ‡∏ï‡πä‡∏∞ ${b.table} - ${b.name}</strong><br>
                        <small>${b.time} | ${b.phone}</small>
                    </div>
                    <div class="btn-group">
                        ${b.status === 'reserved' ? 
                            `<button onclick="updateStatus('${b.table}','occupied')" class="btn-sm" style="background:var(--p)">Check-in</button>` : 
                            `<button onclick="updateStatus('${b.table}','available')" class="btn-sm" style="background:#1976d2">‡∏•‡πâ‡∏≤‡∏á‡πÇ‡∏ï‡πä‡∏∞</button>`
                        }
                        <button onclick="confirmCancel('${b.table}')" class="btn-sm" style="background:#777">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>`;
                list.appendChild(div);
            });
        }
    }

    async function handleFormSubmit(e) {
        e.preventDefault();
        if (!selectedTable) return Swal.fire('‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞', '', 'warning');
        
        const data = {
            action: 'save_booking',
            name: document.getElementById('n').value,
            phone: document.getElementById('ph').value,
            date: document.getElementById('targetDate').value,
            time: document.getElementById('tm').value,
            people: document.getElementById('p').value,
            table: selectedTable,
            zone: selectedTable.startsWith('V') ? '‡∏£‡∏¥‡∏°‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô' : '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'
        };

        Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: () => Swal.showLoading() });
        await fetch(WEB_HOOK, { method: 'POST', body: JSON.stringify(data) });
        Swal.fire('‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '', 'success');
        document.getElementById('bookingForm').reset();
        selectedTable = null;
        fetchData();
    }

    async function updateStatus(no, status) {
        const date = document.getElementById('targetDate').value;
        const data = { action: 'update_status', tableNo: no, status: status, date: date };
        await fetch(WEB_HOOK, { method: 'POST', body: JSON.stringify(data) });
        fetchData();
    }

    async function confirmCancel(tableNo) {
        const res = await Swal.fire({
            title: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á?', icon: 'warning', showCancelButton: true, confirmButtonText: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
        });
        if (res.isConfirmed) updateStatus(tableNo, 'available');
    }
</script>
</body>
</html>
